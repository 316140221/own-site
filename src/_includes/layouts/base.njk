<!doctype html>
<html
  lang="{{ site.language }}"
  data-default-lang="{{ site.defaultLanguage }}"
  data-supported-langs="{{ site.languagesCsv }}"
>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />

    {% set metaTitle = site.name %}
    {% if title %}
      {% set metaTitle = (title | decodeEntities) + ' · ' + site.name %}
    {% endif %}
    {% set metaDescription = description or site.description %}
    {% set canonical = (page.url | url) | absoluteUrl(site.url) %}

    {% set contentLang = site.language %}
    {% if article and article.language %}
      {% set contentLang = article.language %}
    {% endif %}

    {% set ogImage = "" %}
    {% if article and article.image %}
      {% set ogImage = article.image %}
    {% endif %}

    <title>{{ metaTitle }}</title>
    <meta name="description" content="{{ metaDescription }}" />
    <meta name="robots" content="index,follow,max-image-preview:large,max-snippet:-1,max-video-preview:-1" />
    <meta property="og:site_name" content="{{ site.name }}" />
    {% if site.googleSiteVerification %}
      <meta name="google-site-verification" content="{{ site.googleSiteVerification }}" />
    {% endif %}

    <link rel="canonical" href="{{ canonical }}" />
    <meta property="og:url" content="{{ canonical }}" />
    <meta property="og:type" content="{{ ogType or 'website' }}" />
    <meta property="og:title" content="{{ metaTitle }}" />
    <meta property="og:description" content="{{ metaDescription }}" />

    {% if ogImage %}
      {% set ogImageAbs = ogImage | absoluteUrl(site.url) %}
      <meta property="og:image" content="{{ ogImageAbs }}" />
      <meta property="og:image:alt" content="{{ title | decodeEntities if title else site.name }}" />
    {% endif %}

    {% if ogType == 'article' and article %}
      {% if article.publishedAt %}
        <meta property="article:published_time" content="{{ article.publishedAt }}" />
        <meta property="article:modified_time" content="{{ article.publishedAt }}" />
      {% endif %}
      {% if article.category %}
        <meta property="article:section" content="{{ article.category | titleCase }}" />
      {% endif %}
    {% endif %}

    <meta name="twitter:card" content="{% if ogImage %}summary_large_image{% else %}summary{% endif %}" />
    <meta name="twitter:title" content="{{ metaTitle }}" />
    <meta name="twitter:description" content="{{ metaDescription }}" />
    <meta name="twitter:url" content="{{ canonical }}" />
    {% if ogImage %}
      <meta name="twitter:image" content="{{ ogImageAbs }}" />
    {% endif %}

    {% set schemaOrgId = site.url + '#organization' %}
    {% set schemaWebsiteId = site.url + '#website' %}
    {% set schemaWebpageId = canonical + '#webpage' %}
    {% set schemaGraph = [
      {
        '@type': 'Organization',
        '@id': schemaOrgId,
        'name': site.name,
        'url': site.url
      },
      {
        '@type': 'WebSite',
        '@id': schemaWebsiteId,
        'url': site.url,
        'name': site.name,
        'description': site.description,
        'publisher': { '@id': schemaOrgId },
        'potentialAction': {
          '@type': 'SearchAction',
          'target': {
            '@type': 'EntryPoint',
            'urlTemplate': site.url + '/search/?q={search_term_string}'
          },
          'query-input': 'required name=search_term_string'
        }
      },
      {
        '@type': 'WebPage',
        '@id': schemaWebpageId,
        'url': canonical,
        'name': metaTitle,
        'description': metaDescription,
        'isPartOf': { '@id': schemaWebsiteId },
        'inLanguage': contentLang
      }
    ] %}

    {% if ogType == 'article' and article %}
      {% set categoryUrl = ('/category/' + article.category + '/') | url | absoluteUrl(site.url) %}
      {% set breadcrumbId = canonical + '#breadcrumb' %}
      {% set homeUrl = ('/' | url | absoluteUrl(site.url)) %}
      {% set categoryLabel = article.category | titleCase %}
      {% set articleTitle = article.title | decodeEntities %}
      {% set schemaImage = undefined %}
      {% if ogImage %}
        {% set schemaImage = ogImageAbs %}
      {% endif %}
      {% set schemaGraph = schemaGraph.concat([
        {
          '@type': 'BreadcrumbList',
          '@id': breadcrumbId,
          'itemListElement': [
            { '@type': 'ListItem', 'position': 1, 'name': 'Home', 'item': homeUrl },
            { '@type': 'ListItem', 'position': 2, 'name': categoryLabel, 'item': categoryUrl },
            { '@type': 'ListItem', 'position': 3, 'name': articleTitle, 'item': canonical }
          ]
        },
        {
          '@type': 'Article',
          '@id': canonical + '#article',
          'headline': articleTitle,
          'description': (article.summary or metaDescription),
          'datePublished': article.publishedAt,
          'dateModified': article.publishedAt,
          'inLanguage': contentLang,
          'isBasedOn': article.canonicalUrl,
          'mainEntityOfPage': { '@id': schemaWebpageId },
          'publisher': { '@id': schemaOrgId },
          'articleSection': categoryLabel,
          'image': schemaImage
        }
      ]) %}
    {% endif %}
    <script type="application/ld+json">{{ { '@context': 'https://schema.org', '@graph': schemaGraph } | jsonLd | safe }}</script>

    <link
      rel="alternate"
      type="application/rss+xml"
      title="{{ site.name }} RSS"
      href="{{ (rssPath or '/feed.xml') | url }}"
    />

    <link rel="stylesheet" href="{{ '/assets/style.css' | url }}" />
    <script src="{{ '/assets/app.js' | url }}" defer></script>
    {% if pageScript %}
      <script src="{{ pageScript | url }}" defer></script>
    {% endif %}
    {% include "partials/analytics.njk" %}
  </head>
  <body>
    <header class="site-header">
      <div class="container header-inner">
        <a class="brand" href="{{ '/' | url }}">{{ site.brand or site.name }}</a>
        <button
          class="menu-toggle"
          type="button"
          aria-controls="site-nav"
          aria-expanded="false"
          data-i18n="nav.menu"
        >
          Menu
        </button>
        <nav class="nav" id="site-nav">
          <a href="{{ '/' | url }}" data-i18n="nav.home">Home</a>

          {% if amazon and amazon.enabled %}
            <a href="{{ '/shop/' | url }}" data-i18n="nav.shop">Shop</a>
          {% endif %}

          {% if tools and tools.groups %}
            <details class="nav-dropdown">
              <summary data-i18n="nav.tools">Tools</summary>
              <div class="nav-dropdown-menu">
                <a class="nav-dropdown-top" href="{{ '/tools/' | url }}" data-i18n="nav.toolsAll"
                  >All tools</a
                >
                {% for group in tools.groups %}
                  <div class="nav-dropdown-group">
                    <div class="nav-dropdown-title" data-i18n="tools.group.{{ group.id }}">
                      {{ group.label }}
                    </div>
                    {% for t in group.items %}
                      <a href="{{ t.path | url }}" data-i18n="tools.item.{{ t.slug }}.title"
                        >{{ t.label }}</a
                      >
                    {% endfor %}
                  </div>
                {% endfor %}
              </div>
            </details>
          {% endif %}

          {% if categories %}
            <details class="nav-dropdown">
              <summary data-i18n="nav.news">News</summary>
              <div class="nav-dropdown-menu">
                {% for cat in categories %}
                  <a href="{{ ('/category/' + cat.slug + '/') | url }}">{{ cat.label }}</a>
                {% endfor %}
              </div>
            </details>
          {% endif %}

          {% if site.languages and site.languages.length > 1 %}
            <details class="nav-dropdown nav-lang">
              <summary data-i18n="nav.language">Language</summary>
              <div class="nav-dropdown-menu">
                {% for langCode in site.languages %}
                  <button
                    class="nav-lang-btn"
                    type="button"
                    data-set-lang="{{ langCode }}"
                  >
                    {{ site.languageLabels[langCode] or langCode }}
                  </button>
                {% endfor %}
              </div>
            </details>
          {% endif %}

          <a href="{{ '/search/' | url }}" data-i18n="nav.search">Search</a>
        </nav>
      </div>
    </header>

    <main class="container" data-pagefind-body>
      {{ content | safe }}
    </main>

    <footer class="site-footer">
      <div class="container footer-inner">
        <span>Cloud-first utilities · RSS stream · {{ (buildTime or '') | formatDateTime }}</span>
        <div class="footer-links">
          <a class="footer-link" href="{{ '/about/' | url }}" data-i18n="nav.about">About</a>
        </div>
      </div>
    </footer>
  </body>
</html>
