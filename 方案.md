# 独立站（全球新闻聚合）可行方案

> 目标：自动采集全球新闻元数据（标题/摘要/来源/发布时间/链接等），定时生成静态站点并通过 GitHub Pages 发布。

## 0. 已确认配置（MVP）

- 内容范围：仅做「聚合 + 摘要 + 外链」，不抓取与发布全文
- 语言：首期只做英文源（后续可扩展多语言）
- 更新频率：每 8 小时
- 历史保留：90 天
- 成本：零成本（不使用付费 API / AI 摘要翻译）

## 1. 可行性结论

- **技术可行**：采集（API/RSS）→ 结构化存储（JSON）→ 静态站点生成（SSG）→ GitHub Actions 定时构建并部署到 GitHub Pages，这是一条成熟链路。
- **关键约束**在于数据源的**授权与稳定性**：
  - 不建议依赖“抓取 Google 搜索结果”作为主数据源：稳定性差、容易被封/限流、且可能违反服务条款。
  - 推荐使用**官方/开放 API**与**RSS/Atom**作为主数据源（可长期自动化）。

## 2. 方案目标与非目标（MVP 优先）

**MVP（建议 1–2 周）**
- 自动拉取多来源新闻（至少 5–20 个源）。
- 标准化为统一 JSON 数据模型，做去重与分类。
- 生成静态页面：首页、分类页、文章条目页（仅展示元数据+站内摘要+外链）。
- GitHub Actions 定时运行（MVP：每 8 小时，可按数据源限制调整），自动更新并部署 Pages。

**非目标（后续迭代）**
- 还原并发布原文全文（版权风险高、抽取成本高）。
- “抓全网”无限来源（需要大量合规、清洗、反爬与成本控制）。
- 实时流式更新（GitHub Pages 更适合批处理发布）。

## 3. 数据源选择（推荐组合）

### 3.1 首选：RSS/Atom（稳定、透明、低门槛）
- 大量媒体与机构提供 RSS/Atom（国际/本地/行业）。
- 优点：无需 Key、结构明确、便于增量抓取。
- 缺点：摘要长度不一、分类/标签不统一。

### 3.2 可选：开放新闻聚合 API（覆盖更广）
可作为“补充源”或“全球覆盖”的主入口：
- **GDELT 2.1**：覆盖广、免费、无需账号（适合做全球事件/媒体监测类入口）。
- **The Guardian Open Platform**、**NYT API** 等：需要 Key（配额/条款较明确）。
- **NewsAPI** 等商业聚合：需要付费或严格配额（适合后期）。

> 建议策略：先用 RSS 跑通全链路，再接入 1 个“全球聚合 API”（如 GDELT）增强覆盖。

### 3.3 不推荐：抓取 Google 搜索/Google News 网页
- 变动频繁、反爬严格、法律与条款风险更高。
- 若一定要“搜索聚合”，建议使用**提供明确授权的搜索 API**或**合作数据源**。

## 4. 系统架构（离线批处理流水线）

1) **采集 Fetch**：按源（RSS/API）拉取最新条目（增量）。
2) **标准化 Normalize**：统一字段、清洗、语言检测、映射分类。
3) **去重 Dedup**：按 canonical URL / 标题相似度 / 指纹哈希去重。
4) **存储 Store(JSON)**：写入规范化 JSON（可追溯来源）。
5) **构建 Build(SSG)**：读取 JSON，生成静态 HTML/资源。
6) **发布 Deploy**：GitHub Pages 部署。

## 5. 数据模型与目录结构（JSON）

### 5.1 建议字段（规范化 Article）

- `id`：稳定 ID（例如 `sha1(canonicalUrl)` 或 `source+publishedAt+url`）
- `title`
- `summary`：站内摘要（优先用 RSS/API 提供的 description；后续可用摘要模型生成）
- `canonicalUrl`：原文链接
- `source`：`{ name, url, feedUrl, country, language }`
- `publishedAt`：ISO8601
- `fetchedAt`：ISO8601
- `category`：站内分类（如 world/business/tech/sports/...）
- `tags`：可选
- `image`：可选（缩略图 URL）
- `language`：如 `en/zh/...`
- `raw`：可选（保存原始条目字段，便于回溯与调试）

### 5.2 目录结构（可读、可增量、便于 Git 版本管理）

建议两层：`raw`（可选）+ `articles`（规范化后用于建站）

```
data/
  sources.json                # 数据源清单（RSS/API 配置）
  state.json                  # 采集游标/etag/lastModified（每个源）
  blocklist.json              # 黑名单（域名/标题关键字，零成本）
  category-rules.json         # 分类规则（关键词映射，零成本）
  raw/                        # 可选：保存原始响应（便于排错）
    rss/<source>/<yyyymmdd>.json
    api/<source>/<yyyymmdd>.json
  articles/
    <category>/
      <yyyy>/<mm>/<dd>/
        <id>.json             # 单条文章（便于增量与去重）
  indexes/
    latest.json               # 最新 N 条索引（构建加速）
    articles.json             # 文章页构建索引（用于生成 /p/<id>/）
    by-category/<category>.json
    fetch-stats.json          # 每次抓取统计（按源）
    stats.json                # 汇总统计（抓取/清理/索引）
    sitemap.json              # 可选：构建时生成也行
```

> 为了控制仓库体积：MVP 可只保留近 30–90 天或近 N 条（其余归档到 release/外部存储）。

### 5.3 `data/sources.json`（数据源清单）建议格式

建议用“可维护配置”驱动采集，而不是把源写死在代码里：

```json
[
  {
    "id": "bbc_world",
    "name": "BBC News - World",
    "feedUrl": "https://feeds.bbci.co.uk/news/world/rss.xml",
    "siteUrl": "https://www.bbc.co.uk/news",
    "defaultCategory": "world",
    "language": "en",
    "country": "GB",
    "enabled": true
  }
]
```

### 5.4 `data/state.json`（采集游标）建议格式

- 目的：支持增量抓取与缓存命中（ETag/Last-Modified），减少流量与失败概率。

```json
{
  "bbc_world": {
    "etag": "\"abc123\"",
    "lastModified": "Wed, 01 Jan 2025 00:00:00 GMT",
    "lastFetchAt": "2025-01-01T08:00:00.000Z"
  }
}
```

## 6. 静态站点生成与页面设计

### 6.1 技术栈选择（MVP）

**Eleventy(11ty) + Nunjucks/Liquid**
- 选择理由：数据驱动静态站点最省事；模板直观；构建快；适合 GitHub Pages。
- 约定：构建时读取 `data/indexes/*.json` 与文章 JSON，生成列表页/条目页。

**方案 B：Astro（更现代，后续扩展强）**
- 优点：组件化、性能好、生态强。
- 缺点：初期配置略多。

### 6.2 页面结构（MVP）

- `/`：最新新闻流（按时间倒序），支持简单筛选（分类/语言）
- `/category/<name>/`：分类聚合
- `/p/<id>/`：条目页
  - 展示：标题、来源、发布时间、摘要、跳转原文按钮
  - 不建议展示全文（版权/合规）
- `/about/`：站点说明、免责声明、数据来源列表
- SEO：`sitemap.xml`、`robots.txt`、OpenGraph、规范化 URL

### 6.3 站内搜索（可选但很有用）

- 静态搜索推荐：`pagefind`（构建期生成索引，前端纯静态，零成本）。

## 7. 自动化（GitHub Actions + Pages）

### 7.1 运行节奏
- 采集：MVP 每 8 小时（视数据源限制调整）
- 构建部署：采集成功后触发（同一 workflow 中完成）

### 7.2 工作流职责
- `fetch`：拉取最新数据 → 写入 `data/` → 提交到仓库（或仅作为构建产物）
- `build`：SSG 构建输出到 `dist/`（或 `site/` 的输出目录）
- `deploy`：部署到 GitHub Pages

> 两种模式：
> 1) **数据入库进 Git**：实现最简单，可追溯；但仓库会变大。  
> 2) **数据不入库**：仅构建产物发布；但历史追溯与调试弱。  
> 建议 MVP 先用 1)，并限制保留窗口控制体积。

### 7.3 建议的实现落点（MVP）

- 数据入库：提交 `data/articles` 与 `data/indexes`，并用保留策略控制体积。
- 构建输出：固定到 `dist/`，由 Pages 部署该目录。
- 失败处理：单源失败不影响整体；抓取超时与重试；输出失败源列表到构建日志。

### 7.4 本仓库实现（落地说明）

- 定时更新与部署：`.github/workflows/update-and-deploy.yml`
- 本地更新数据：`npm run update`（抓取 → 清理 90 天外数据 → 重建索引）
- 构建站点（含搜索索引）：`npm run build:site`

## 8. 去重、分类与质量策略

### 8.1 去重
- 主键：`canonicalUrl`（优先）
- 备用：`(title + source + publishedAt)` 指纹哈希
- 近似重复：标题相似度（可后续再加）

**URL 规范化（建议 MVP 就做）**
- 去掉常见追踪参数：`utm_*`、`gclid`、`fbclid`
- 统一协议与尾斜杠：`http/https`、末尾 `/`
- 可选：移除无关 query（按域名做白名单规则）

### 8.2 分类
优先顺序：
1) 源自带分类（RSS category / API section）
2) 源到站内分类映射表（可维护）
3) 轻量 NLP 分类（后续迭代）

**本仓库实现（零成本规则）**
- `data/category-rules.json`：按标题/摘要/标签关键词把条目映射到固定分类（在构建索引时生效）。

### 8.3 内容策略（合规优先）
- 仅展示：标题/摘要/缩略图（若授权或源提供）+ 原文链接
- 明确标注来源与版权归属；提供删除/投诉邮箱或流程

## 9. 风险与对策

- **版权/授权风险**：不抓取并发布全文；只展示摘要与链接；保留来源信息与免责声明。
- **数据源不稳定**：多源冗余；RSS 优先；API 做补充；失败重试与降级。
- **仓库体积膨胀**：保留窗口（例如 60 天）；只存规范化字段；必要时把历史归档到 release/对象存储。
- **重复/垃圾信息**：去重、黑名单、质量分（后续）与人工审查入口（后续）。

## 10. 开发里程碑（建议拆解）

1) 选定技术栈与站点骨架（SSG + 基础页面）
2) 定义数据源清单 `data/sources.json`（先 10 个 RSS）
3) 实现采集脚本：增量拉取、解析、标准化、写入 JSON
4) 实现去重与分类映射
5) SSG 读取 `data/articles` 生成页面 + sitemap
6) GitHub Actions：定时 fetch + build + deploy
7) 增加站内搜索与基本 SEO（可选）

## 11. 分类与展示建议（MVP 默认值，可调整）

- 分类（slug）：`world`、`business`、`tech`、`science`、`health`、`sports`、`entertainment`
- 站点文案语言：中文 UI + 英文内容（也可全英文 UI）
- 条目页：展示摘要（来自 RSS description）+ “阅读原文”跳转

## 12. 开发TODO（5轮迭代循环）

- 详见：`开发TODO.md`

## 13. 本地开发与发布（按当前实现）

### 13.1 本地命令

- 安装依赖：`npm ci`
- 抓取与入库：`npm run update`
- 本地预览：`npm run dev`（11ty 预览）
- 构建发布：`npm run build:site`（11ty + Pagefind）

### 13.2 GitHub Pages 注意点

- Actions 部署：已提供 workflow（每 8 小时触发一次，UTC）。
- 站点 URL 与路径前缀：
  - `SITE_URL`：用于 `sitemap.xml`/canonical（建议在仓库变量或 workflow env 中设置）
  - `PATH_PREFIX`：如果是 Project Pages，通常是 `/<repo>/`；User Pages 通常是 `/`
